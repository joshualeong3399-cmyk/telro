import{a as r,j as e}from"./index-B5tky5X5.js";import{r as u}from"./vendor-DqoTkSux.js";import{N as s,T,S as y,B as x,a0 as v,a4 as C,a5 as F,M as O,O as p,ah as b,ad as X,a as _,h as $,a1 as A,a2 as E,a3 as M,Q as w}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const h={list:()=>r.get("/outbound-routes"),get:a=>r.get(`/outbound-routes/${a}`),create:a=>r.post("/outbound-routes",a),update:(a,i)=>r.put(`/outbound-routes/${a}`,i),delete:a=>r.delete(`/outbound-routes/${a}`),reorder:a=>r.post("/outbound-routes/reorder",{ids:a})},{Title:q}=T,z=[{id:1,name:"本地通话",pattern:"_0NXXXXXXXX",stripDigits:0,trunkId:1,trunkName:"主干线1",priority:1,enabled:!0,createdAt:"2025-01-01",description:"本地11位号码"},{id:2,name:"长途通话",pattern:"_0[^89]NXXXXXX",stripDigits:0,trunkId:1,trunkName:"主干线1",priority:2,enabled:!0,createdAt:"2025-01-05",description:"国内长途"},{id:3,name:"国际通话",pattern:"_00.",stripDigits:0,trunkId:2,trunkName:"备用干线",priority:3,enabled:!1,createdAt:"2025-01-10",description:"国际00开头"}],L=()=>{const[a,i]=u.useState([]),[g,I]=u.useState(!1),[k,n]=u.useState(!1),[d,f]=u.useState(null),[l]=s.useForm(),j=async()=>{I(!0);try{i(await h.list())}catch{i(z)}finally{I(!1)}};u.useEffect(()=>{j()},[]);const N=()=>{f(null),l.resetFields(),l.setFieldsValue({stripDigits:0,priority:a.length+1,enabled:!0}),n(!0)},S=t=>{f(t),l.setFieldsValue(t),n(!0)},D=async()=>{const t=await l.validateFields();try{d?(await h.update(d.id,t),w.success("更新成功")):(await h.create(t),w.success("创建成功")),n(!1),j()}catch{const o={...t,id:Date.now(),trunkName:"中继",priority:t.priority??a.length+1,enabled:t.enabled??!0,createdAt:new Date().toISOString()};i(m=>d?m.map(c=>c.id===d.id?{...c,...t}:c):[...m,o]),n(!1)}},R=[{title:"优先级",dataIndex:"priority",width:70,align:"center"},{title:"名称",dataIndex:"name",width:160},{title:"拨号模式",dataIndex:"pattern",width:180,render:t=>e.jsx("code",{style:{background:"#f0f0f0",padding:"2px 6px",borderRadius:4},children:t})},{title:"去除前缀位数",dataIndex:"stripDigits",width:100,align:"center"},{title:"前缀追加",dataIndex:"prepend",width:100,render:t=>t??"-"},{title:"绑定中继",dataIndex:"trunkName",width:130,render:t=>e.jsx(_,{color:"blue",children:t})},{title:"备注",dataIndex:"description",width:160,ellipsis:!0},{title:"启用",dataIndex:"enabled",width:70,render:t=>e.jsx(X,{checked:t,size:"small",disabled:!0})},{title:"操作",key:"actions",width:100,fixed:"right",render:(t,o)=>e.jsxs(y,{children:[e.jsx($,{title:"编辑",children:e.jsx(x,{size:"small",icon:e.jsx(A,{}),onClick:()=>S(o)})}),e.jsx(E,{title:"确认删除？",onConfirm:async()=>{try{await h.delete(o.id)}catch{}i(m=>m.filter(c=>c.id!==o.id))},children:e.jsx(x,{size:"small",danger:!0,icon:e.jsx(M,{})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(q,{level:4,style:{margin:0},children:"出站路由"}),e.jsxs(y,{children:[e.jsx(x,{icon:e.jsx(v,{}),onClick:j,children:"刷新"}),e.jsx(x,{type:"primary",icon:e.jsx(C,{}),onClick:N,children:"新增路由"})]})]}),e.jsx(F,{columns:R,dataSource:a,rowKey:"id",loading:g,scroll:{x:900}}),e.jsx(O,{title:d?"编辑出站路由":"新增出站路由",open:k,onOk:D,onCancel:()=>n(!1),width:520,okText:"保存",cancelText:"取消",children:e.jsxs(s,{form:l,layout:"vertical",style:{marginTop:16},children:[e.jsx(s.Item,{name:"name",label:"路由名称",rules:[{required:!0}],children:e.jsx(p,{})}),e.jsx(s.Item,{name:"pattern",label:"拨号模式",rules:[{required:!0}],extra:"支持 Asterisk 拨号规则，如 _9NXXNXXXXXX",children:e.jsx(p,{placeholder:"_NXXXXXXXX"})}),e.jsx(s.Item,{name:"trunkId",label:"绑定中继 ID",rules:[{required:!0}],children:e.jsx(b,{style:{width:"100%"}})}),e.jsxs(y.Compact,{style:{width:"100%"},children:[e.jsx(s.Item,{name:"stripDigits",label:"去除前缀位数",style:{width:"50%"},children:e.jsx(b,{min:0,style:{width:"100%"}})}),e.jsx(s.Item,{name:"prepend",label:"追加前缀",style:{width:"50%"},children:e.jsx(p,{placeholder:"可选"})})]}),e.jsx(s.Item,{name:"callerId",label:"强制主叫 ID",children:e.jsx(p,{placeholder:"可选，覆盖主叫号码"})}),e.jsx(s.Item,{name:"priority",label:"优先级",children:e.jsx(b,{min:1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"description",label:"备注",children:e.jsx(p,{})}),e.jsx(s.Item,{name:"enabled",label:"启用",valuePropName:"checked",children:e.jsx(X,{})})]})})]})};export{L as default};
