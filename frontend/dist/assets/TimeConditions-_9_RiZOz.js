import{a as p,j as e}from"./index-B5tky5X5.js";import{r}from"./vendor-DqoTkSux.js";import{N as o,T as _,H as V,S as c,B as m,a0 as D,a4 as N,a5 as q,M as K,O as k,a6 as A,an as P,ao as C,U as R,ad as z,a as b,h as L,a1 as U,a2 as Y,a3 as G,Q as H}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const f={list:()=>p.get("/time-conditions"),get:n=>p.get(`/time-conditions/${n}`),create:n=>p.post("/time-conditions",n),update:(n,d)=>p.put(`/time-conditions/${n}`,d),delete:n=>p.delete(`/time-conditions/${n}`)},{Title:Q,Text:y}=_,v=["日","一","二","三","四","五","六"],W=["Asia/Shanghai","Asia/Tokyo","America/New_York","Europe/London","UTC"],Z=[{id:1,name:"工作时间",timezone:"Asia/Shanghai",rules:[{weekdays:[1,2,3,4,5],startTime:"09:00",endTime:"18:00"}],matchAction:"销售队列",noMatchAction:"非工作 IVR",enabled:!0,createdAt:"2025-01-01"},{id:2,name:"午休时间",timezone:"Asia/Shanghai",rules:[{weekdays:[1,2,3,4,5],startTime:"12:00",endTime:"13:30"}],matchAction:"语音信箱",noMatchAction:"销售队列",enabled:!0,createdAt:"2025-01-05"}],se=()=>{const[n,d]=r.useState([]),[E,I]=r.useState(!1),[M,h]=r.useState(!1),[x,S]=r.useState(null),[T,u]=r.useState([{weekdays:[1,2,3,4,5],startTime:"09:00",endTime:"18:00"}]),[j]=o.useForm(),g=async()=>{I(!0);try{d(await f.list())}catch{d(Z)}finally{I(!1)}};r.useEffect(()=>{g()},[]);const $=()=>{S(null),j.resetFields(),j.setFieldsValue({timezone:"Asia/Shanghai",enabled:!0}),u([{weekdays:[1,2,3,4,5],startTime:"09:00",endTime:"18:00"}]),h(!0)},O=t=>{S(t),j.setFieldsValue(t),u(t.rules),h(!0)},F=async()=>{const a={...await j.validateFields(),rules:T};try{x?(await f.update(x.id,a),H.success("更新成功")):(await f.create(a),H.success("创建成功")),h(!1),g()}catch{const s={...a,id:Date.now(),enabled:a.enabled??!0,createdAt:new Date().toISOString()};d(i=>x?i.map(l=>l.id===x.id?{...l,...a}:l):[...i,s]),h(!1)}},w=(t,a)=>{u(s=>s.map((i,l)=>l===t?{...i,...a}:i))},B=[{title:"名称",dataIndex:"name",width:160},{title:"时区",dataIndex:"timezone",width:130},{title:"规则",key:"rules",width:260,render:(t,a)=>a.rules.map((s,i)=>e.jsxs("div",{style:{marginBottom:4},children:[e.jsx(b,{color:"blue",children:s.weekdays.map(l=>`周${v[l]}`).join("/")}),e.jsxs(y,{type:"secondary",style:{fontSize:12},children:[s.startTime," – ",s.endTime]})]},i))},{title:"匹配动作",key:"actions_col",width:220,render:(t,a)=>e.jsxs(c,{direction:"vertical",size:2,children:[e.jsxs(c,{size:4,children:[e.jsx(b,{color:"green",children:"匹配"}),e.jsx(y,{children:a.matchAction})]}),e.jsxs(c,{size:4,children:[e.jsx(b,{color:"red",children:"不匹配"}),e.jsx(y,{children:a.noMatchAction})]})]})},{title:"启用",dataIndex:"enabled",width:70,render:t=>e.jsx(z,{checked:t,size:"small",disabled:!0})},{title:"操作",key:"op",width:100,fixed:"right",render:(t,a)=>e.jsxs(c,{children:[e.jsx(L,{title:"编辑",children:e.jsx(m,{size:"small",icon:e.jsx(U,{}),onClick:()=>O(a)})}),e.jsx(Y,{title:"确认删除？",onConfirm:async()=>{try{await f.delete(a.id)}catch{}d(s=>s.filter(i=>i.id!==a.id))},children:e.jsx(m,{size:"small",danger:!0,icon:e.jsx(G,{})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(Q,{level:4,style:{margin:0},children:[e.jsx(V,{})," 时间条件"]}),e.jsxs(c,{children:[e.jsx(m,{icon:e.jsx(D,{}),onClick:g,children:"刷新"}),e.jsx(m,{type:"primary",icon:e.jsx(N,{}),onClick:$,children:"新建"})]})]}),e.jsx(q,{columns:B,dataSource:n,rowKey:"id",loading:E,scroll:{x:860}}),e.jsx(K,{title:x?"编辑时间条件":"新建时间条件",open:M,onOk:F,onCancel:()=>h(!1),width:560,okText:"保存",cancelText:"取消",children:e.jsxs(o,{form:j,layout:"vertical",style:{marginTop:16},children:[e.jsx(o.Item,{name:"name",label:"名称",rules:[{required:!0}],children:e.jsx(k,{})}),e.jsx(o.Item,{name:"timezone",label:"时区",children:e.jsx(A,{children:W.map(t=>e.jsx(A.Option,{value:t,children:t},t))})}),e.jsxs(o.Item,{label:"时间规则",children:[T.map((t,a)=>e.jsxs("div",{style:{background:"#fafafa",padding:12,borderRadius:8,marginBottom:8,border:"1px solid #f0f0f0"},children:[e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(y,{type:"secondary",style:{marginRight:8},children:"星期："}),e.jsx(P.Group,{options:v.map((s,i)=>({label:`周${s}`,value:i})),value:t.weekdays,onChange:s=>w(a,{weekdays:s})})]}),e.jsxs(c,{children:[e.jsx(y,{type:"secondary",children:"时间段："}),e.jsx(C,{format:"HH:mm",value:R(t.startTime,"HH:mm"),onChange:s=>w(a,{startTime:(s==null?void 0:s.format("HH:mm"))??t.startTime})}),e.jsx("span",{children:"—"}),e.jsx(C,{format:"HH:mm",value:R(t.endTime,"HH:mm"),onChange:s=>w(a,{endTime:(s==null?void 0:s.format("HH:mm"))??t.endTime})}),T.length>1&&e.jsx(m,{size:"small",danger:!0,onClick:()=>u(s=>s.filter((i,l)=>l!==a)),children:"删除"})]})]},a)),e.jsx(m,{size:"small",onClick:()=>u(t=>[...t,{weekdays:[1,2,3,4,5],startTime:"09:00",endTime:"18:00"}]),children:"+ 添加规则"})]}),e.jsx(o.Item,{name:"matchAction",label:"匹配时目标",rules:[{required:!0}],children:e.jsx(k,{placeholder:"队列名/分机号/IVR 名"})}),e.jsx(o.Item,{name:"noMatchAction",label:"不匹配时目标",rules:[{required:!0}],children:e.jsx(k,{placeholder:"队列名/分机号/IVR 名"})}),e.jsx(o.Item,{name:"enabled",label:"启用",valuePropName:"checked",children:e.jsx(z,{})})]})})]})};export{se as default};
