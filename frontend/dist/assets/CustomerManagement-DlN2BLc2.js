import{a as m,j as t}from"./index-B5tky5X5.js";import{r as l}from"./vendor-DqoTkSux.js";import{N as o,T as _,K as B,O as u,B as y,a4 as K,a5 as Y,M as N,a6 as V,U as h,S as O,a as q,a1 as G,a2 as H,a3 as U,Q as f}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const p={list:n=>m.get("/customers",{params:n}),create:n=>m.post("/customers",n),update:(n,a)=>m.put(`/customers/${n}`,a),remove:n=>m.delete(`/customers/${n}`)},j=["VIP","潜在客户","高价值","电商","企业客户","已成交","跟进中","流失客户"],Q={VIP:"gold",潜在客户:"blue",高价值:"red",电商:"purple",企业客户:"cyan",已成交:"green",跟进中:"orange",流失客户:"default"},J=["张三","李四","王五","赵六","钱七","孙八","周九","吴十","郑一","冯二"],T=Array.from({length:32},(n,a)=>({id:a+1,name:J[a%10],phone:`1${["35","36","57","89","38"][a%5]}${String(1e7+a*1234567).slice(0,8)}`,tags:[j[a%8],j[(a+3)%8]],remark:a%3===0?"重要客户，优先跟进":a%3===1?"等待回访":"",createdAt:h().subtract(a*3,"day").toISOString()})),te=()=>{const[n,a]=l.useState(T),[A,g]=l.useState(T.length),[v,S]=l.useState(!1),[x,w]=l.useState(1),[I,M]=l.useState(""),[z,c]=l.useState(!1),[i,k]=l.useState(null),[$,C]=l.useState(!1),[d]=o.useForm(),b=l.useCallback(async()=>{S(!0);try{const e=await p.list({page:x,pageSize:10,keyword:I});a(e.records),g(e.total)}catch{}finally{S(!1)}},[x,I]);l.useEffect(()=>{b()},[b]);const D=()=>{k(null),d.resetFields(),c(!0)},E=e=>{k(e),d.setFieldsValue({name:e.name,phone:e.phone,tags:e.tags,remark:e.remark}),c(!0)},F=async e=>{try{await p.remove(e)}catch{}a(s=>s.filter(r=>r.id!==e)),g(s=>s-1),f.success("删除成功")},R=async()=>{C(!0);try{const e=await d.validateFields();if(i){try{await p.update(i.id,e)}catch{}a(s=>s.map(r=>r.id===i.id?{...r,...e}:r)),f.success("更新成功")}else{const s={...e,id:Date.now(),createdAt:new Date().toISOString()};try{const r=await p.create(e);a(P=>[r,...P])}catch{a(r=>[s,...r])}g(r=>r+1),f.success("创建成功")}c(!1)}finally{C(!1)}},L=[{title:"客户姓名",dataIndex:"name",key:"name",width:100},{title:"电话",dataIndex:"phone",key:"phone",width:140,render:e=>t.jsx("span",{style:{fontFamily:"monospace"},children:e})},{title:"标签",dataIndex:"tags",key:"tags",render:e=>t.jsx(O,{size:[4,4],wrap:!0,children:e.map(s=>t.jsx(q,{color:Q[s]??"default",children:s},s))})},{title:"备注",dataIndex:"remark",key:"remark",ellipsis:!0,render:e=>e||t.jsx("span",{style:{color:"#bbb"},children:"—"})},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:160,render:e=>h(e).format("YYYY-MM-DD HH:mm"),sorter:(e,s)=>h(e.createdAt).unix()-h(s.createdAt).unix()},{title:"操作",key:"action",width:130,align:"center",render:(e,s)=>t.jsxs(O,{size:0,children:[t.jsx(y,{type:"link",size:"small",icon:t.jsx(G,{}),onClick:()=>E(s),children:"编辑"}),t.jsx(H,{title:"确定删除该客户？",onConfirm:()=>F(s.id),children:t.jsx(y,{type:"link",size:"small",danger:!0,icon:t.jsx(U,{}),children:"删除"})})]})}];return t.jsxs("div",{children:[t.jsx(_.Title,{level:4,style:{marginBottom:16},children:"客户管理"}),t.jsxs(B,{children:[t.jsxs("div",{style:{marginBottom:16,display:"flex",gap:8},children:[t.jsx(u.Search,{placeholder:"搜索客户姓名/电话...",style:{width:280},allowClear:!0,onSearch:e=>{w(1),M(e)}}),t.jsx(y,{type:"primary",icon:t.jsx(K,{}),onClick:D,children:"新建客户"})]}),t.jsx(Y,{dataSource:n,columns:L,rowKey:"id",loading:v,size:"middle",pagination:{current:x,pageSize:10,total:A,onChange:e=>w(e),showSizeChanger:!1,showTotal:e=>`共 ${e} 条`}})]}),t.jsx(N,{title:i?"编辑客户":"新建客户",open:z,onOk:R,onCancel:()=>c(!1),confirmLoading:$,destroyOnClose:!0,width:480,children:t.jsxs(o,{form:d,layout:"vertical",style:{marginTop:16},children:[t.jsx(o.Item,{name:"name",label:"客户姓名",rules:[{required:!0,message:"请输入客户姓名"}],children:t.jsx(u,{placeholder:"客户姓名"})}),t.jsx(o.Item,{name:"phone",label:"电话",rules:[{required:!0,message:"请输入电话号码"},{pattern:/^[0-9\-+() ]{7,20}$/,message:"请输入有效号码"}],children:t.jsx(u,{placeholder:"手机号 / 固话"})}),t.jsx(o.Item,{name:"tags",label:"标签",children:t.jsx(V,{mode:"multiple",placeholder:"选择标签（可多选）",options:j.map(e=>({value:e,label:e})),allowClear:!0})}),t.jsx(o.Item,{name:"remark",label:"备注",children:t.jsx(u.TextArea,{rows:3,placeholder:"客户备注（可选）"})})]})})]})};export{te as default};
