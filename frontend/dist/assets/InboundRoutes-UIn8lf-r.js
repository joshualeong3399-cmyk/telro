import{a as r,j as e}from"./index-B5tky5X5.js";import{r as u}from"./vendor-DqoTkSux.js";import{N as i,T as F,S as b,B as m,a0 as X,a4 as q,a5 as A,M as D,O as x,a6 as v,ad as y,a as I,al as $,h as E,a1 as M,a2 as _,a3 as B,Q as w}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const h={list:()=>r.get("/inbound-routes"),get:a=>r.get(`/inbound-routes/${a}`),create:a=>r.post("/inbound-routes",a),update:(a,s)=>r.put(`/inbound-routes/${a}`,s),delete:a=>r.delete(`/inbound-routes/${a}`),reorder:a=>r.post("/inbound-routes/reorder",{ids:a})},{Title:L}=F,{Option:V}=v,T={extension:"分机",queue:"队列",ivr:"IVR 菜单",ringgroup:"振铃组",voicemail:"语音信箱",hangup:"挂断"},z={extension:"blue",queue:"cyan",ivr:"purple",ringgroup:"orange",voicemail:"green",hangup:"red"},K=[{id:1,name:"主线入站",did:"02188888888",action:"ivr",actionTarget:"IVR 主菜单",priority:1,enabled:!0,createdAt:"2025-01-01"},{id:2,name:"销售热线",did:"02188888889",action:"queue",actionTarget:"销售队列",priority:2,enabled:!0,createdAt:"2025-01-05"},{id:3,name:"客服专线",did:"02188888890",cidNumber:"1390000",action:"extension",actionTarget:"8001",priority:3,enabled:!1,createdAt:"2025-01-10"}],J=()=>{const[a,s]=u.useState([]),[S,g]=u.useState(!1),[R,l]=u.useState(!1),[d,f]=u.useState(null),[o]=i.useForm(),j=async()=>{g(!0);try{s(await h.list())}catch{s(K)}finally{g(!1)}};u.useEffect(()=>{j()},[]);const O=()=>{f(null),o.resetFields(),o.setFieldsValue({priority:a.length+1,enabled:!0,action:"queue"}),l(!0)},C=t=>{f(t),o.setFieldsValue(t),l(!0)},k=async()=>{const t=await o.validateFields();try{d?(await h.update(d.id,t),w.success("更新成功")):(await h.create(t),w.success("创建成功")),l(!1),j()}catch{const n={...t,id:Date.now(),createdAt:new Date().toISOString(),priority:t.priority??a.length+1,enabled:t.enabled??!0};s(p=>d?p.map(c=>c.id===d.id?{...c,...t}:c):[...p,n]),l(!1)}},N=[{title:"优先级",dataIndex:"priority",width:70,align:"center"},{title:"名称",dataIndex:"name",width:160},{title:"DID 号码",dataIndex:"did",width:160,render:t=>e.jsx("code",{style:{background:"#f0f0f0",padding:"2px 6px",borderRadius:4},children:t})},{title:"主叫过滤",dataIndex:"cidNumber",width:130,render:t=>t??e.jsx(I,{color:"default",children:"不限"})},{title:"目标动作",key:"action",width:180,render:(t,n)=>e.jsxs(b,{children:[e.jsx(I,{color:z[n.action],children:T[n.action]}),n.actionTarget&&e.jsxs(e.Fragment,{children:[e.jsx($,{style:{color:"#999"}}),e.jsx("span",{children:n.actionTarget})]})]})},{title:"启用",dataIndex:"enabled",width:70,render:t=>e.jsx(y,{checked:t,size:"small",disabled:!0})},{title:"操作",key:"actions",width:130,fixed:"right",render:(t,n)=>e.jsxs(b,{children:[e.jsx(E,{title:"编辑",children:e.jsx(m,{size:"small",icon:e.jsx(M,{}),onClick:()=>C(n)})}),e.jsx(_,{title:"确认删除？",onConfirm:async()=>{try{await h.delete(n.id)}catch{}s(p=>p.filter(c=>c.id!==n.id))},children:e.jsx(m,{size:"small",danger:!0,icon:e.jsx(B,{})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(L,{level:4,style:{margin:0},children:"入站路由"}),e.jsxs(b,{children:[e.jsx(m,{icon:e.jsx(X,{}),onClick:j,children:"刷新"}),e.jsx(m,{type:"primary",icon:e.jsx(q,{}),onClick:O,children:"新增路由"})]})]}),e.jsx(A,{columns:N,dataSource:a,rowKey:"id",loading:S,scroll:{x:800}}),e.jsx(D,{title:d?"编辑入站路由":"新增入站路由",open:R,onOk:k,onCancel:()=>l(!1),width:520,okText:"保存",cancelText:"取消",children:e.jsxs(i,{form:o,layout:"vertical",style:{marginTop:16},children:[e.jsx(i.Item,{name:"name",label:"路由名称",rules:[{required:!0}],children:e.jsx(x,{})}),e.jsx(i.Item,{name:"did",label:"DID 号码",rules:[{required:!0}],extra:"支持精确匹配或正则模式 _NXXNXXXXXX",children:e.jsx(x,{placeholder:"例如：02188888888"})}),e.jsx(i.Item,{name:"cidNumber",label:"主叫号码过滤",extra:"留空表示匹配所有来电",children:e.jsx(x,{placeholder:"可选"})}),e.jsx(i.Item,{name:"action",label:"路由动作",rules:[{required:!0}],children:e.jsx(v,{children:Object.entries(T).map(([t,n])=>e.jsx(V,{value:t,children:n},t))})}),e.jsx(i.Item,{name:"actionTarget",label:"目标（分机号/队列名等）",children:e.jsx(x,{placeholder:"例如：8001 或 销售队列"})}),e.jsx(i.Item,{name:"priority",label:"优先级",children:e.jsx(x,{type:"number"})}),e.jsx(i.Item,{name:"enabled",label:"启用",valuePropName:"checked",children:e.jsx(y,{})})]})})]})};export{J as default};
