import{j as e}from"./index-B5tky5X5.js";import{r as d}from"./vendor-DqoTkSux.js";import{N as r,T as ee,s as te,B as m,a4 as ae,Y as y,Z as i,K as S,_ as N,S as E,a6 as z,O as o,a0 as se,a5 as le,M as $,l as _,a as M,ad as q,aA as B,U as l,h as T,a1 as re,a2 as ne,a3 as ie,Q as u}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const{Title:oe,Text:v}=ee,{Option:D}=z,b={admin:"red",operator:"orange",merchant:"blue",employee:"green"},f={admin:"管理员",operator:"运营商",merchant:"商家",employee:"员工"},de=[{id:1,username:"admin",displayName:"系统管理员",email:"admin@telro.com",role:"admin",enabled:!0,lastLogin:l().subtract(10,"minute").toISOString(),createdAt:l().subtract(365,"day").toISOString()},{id:2,username:"operator1",displayName:"张运营",email:"op1@telro.com",role:"operator",extensionNumber:"8001",enabled:!0,lastLogin:l().subtract(2,"hour").toISOString(),createdAt:l().subtract(180,"day").toISOString()},{id:3,username:"merchant_a",displayName:"商家A",email:"merchant_a@example.com",role:"merchant",enabled:!0,lastLogin:l().subtract(1,"day").toISOString(),createdAt:l().subtract(90,"day").toISOString()},{id:4,username:"agent001",displayName:"李小明",email:"agent001@telro.com",role:"employee",extensionNumber:"1001",enabled:!0,lastLogin:l().subtract(30,"minute").toISOString(),createdAt:l().subtract(60,"day").toISOString()},{id:5,username:"agent002",displayName:"王芳",email:"agent002@telro.com",role:"employee",extensionNumber:"1002",enabled:!1,lastLogin:l().subtract(30,"day").toISOString(),createdAt:l().subtract(60,"day").toISOString()},{id:6,username:"agent003",displayName:"赵磊",email:"agent003@telro.com",role:"employee",extensionNumber:"1003",enabled:!0,lastLogin:l().subtract(5,"hour").toISOString(),createdAt:l().subtract(45,"day").toISOString()},{id:7,username:"merchant_b",displayName:"商家B",email:"merchant_b@example.com",role:"merchant",enabled:!1,createdAt:l().subtract(20,"day").toISOString()}],k=["admin","operator","merchant","employee"],xe=()=>{const[h,x]=d.useState(de),[K,p]=d.useState(!1),[V,w]=d.useState(!1),[n,I]=d.useState(null),[F,j]=d.useState(!1),[g,P]=d.useState(""),[L,A]=d.useState(""),[c]=r.useForm(),[O]=r.useForm(),H=h.filter(t=>!(L&&t.role!==L||g&&!t.username.includes(g)&&!t.displayName.includes(g)&&!t.email.includes(g))),C={total:h.length,byRole:k.map(t=>({role:t,count:h.filter(a=>a.role===t).length})),enabled:h.filter(t=>t.enabled).length},U=()=>{I(null),c.resetFields(),c.setFieldsValue({enabled:!0}),p(!0)},Q=t=>{I(t),c.setFieldsValue({...t}),p(!0)},X=t=>{I(t),O.resetFields(),w(!0)},Y=async()=>{const t=await c.validateFields();if(j(!0),await new Promise(a=>setTimeout(a,600)),n)x(a=>a.map(s=>s.id===n.id?{...s,...t}:s)),u.success("用户信息已更新");else{const a={...t,id:Date.now(),createdAt:new Date().toISOString(),enabled:t.enabled??!0};x(s=>[a,...s]),u.success("用户已创建")}j(!1),p(!1)},Z=t=>{x(a=>a.filter(s=>s.id!==t)),u.success("用户已删除")},G=(t,a)=>{x(s=>s.map(R=>R.id===t?{...R,enabled:a}:R)),u.success(a?"用户已启用":"用户已停用")},J=async()=>{await O.validateFields(),j(!0),await new Promise(t=>setTimeout(t,500)),u.success(`用户 ${n==null?void 0:n.displayName} 密码已重置`),j(!1),w(!1)},W=[{title:"用户名",dataIndex:"username",width:120,render:t=>e.jsxs(e.Fragment,{children:[e.jsx(_,{style:{marginRight:6}}),e.jsx(v,{strong:!0,children:t})]})},{title:"显示名称",dataIndex:"displayName",width:120},{title:"邮箱",dataIndex:"email",width:180,ellipsis:!0},{title:"角色",dataIndex:"role",width:100,render:t=>e.jsx(M,{color:b[t],children:f[t]})},{title:"分机号",dataIndex:"extensionNumber",width:90,render:t=>t||e.jsx(v,{type:"secondary",children:"—"})},{title:"状态",dataIndex:"enabled",width:90,render:(t,a)=>e.jsx(q,{checked:t,size:"small",onChange:s=>G(a.id,s),checkedChildren:"启用",unCheckedChildren:"停用"})},{title:"最后登录",dataIndex:"lastLogin",width:150,ellipsis:!0,render:t=>t?l(t).format("MM-DD HH:mm"):e.jsx(v,{type:"secondary",children:"从未登录"})},{title:"操作",width:160,align:"center",render:(t,a)=>e.jsxs(E,{size:0,children:[e.jsx(T,{title:"编辑",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(re,{}),onClick:()=>Q(a)})}),e.jsx(T,{title:"重置密码",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(B,{}),onClick:()=>X(a)})}),e.jsx(ne,{title:"确定删除该用户？",onConfirm:()=>Z(a.id),children:e.jsx(T,{title:"删除",children:e.jsx(m,{type:"link",size:"small",danger:!0,icon:e.jsx(ie,{})})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(oe,{level:4,style:{margin:0},children:[e.jsx(te,{})," 用户管理"]}),e.jsx(m,{type:"primary",icon:e.jsx(ae,{}),onClick:U,children:"创建用户"})]}),e.jsxs(y,{gutter:[12,12],style:{marginBottom:16},children:[e.jsx(i,{xs:12,sm:6,children:e.jsx(S,{size:"small",style:{borderTop:"3px solid #1677ff",borderRadius:8},children:e.jsx(N,{title:"总用户数",value:C.total,valueStyle:{color:"#1677ff",fontSize:22}})})}),C.byRole.map(t=>e.jsx(i,{xs:12,sm:6,md:4,lg:3,children:e.jsx(S,{size:"small",style:{borderTop:`3px solid ${b[t.role]}`,borderRadius:8},children:e.jsx(N,{title:f[t.role],value:t.count,valueStyle:{color:b[t.role],fontSize:22}})})},t.role)),e.jsx(i,{xs:12,sm:6,md:4,lg:3,children:e.jsx(S,{size:"small",style:{borderTop:"3px solid #52c41a",borderRadius:8},children:e.jsx(N,{title:"已启用",value:C.enabled,valueStyle:{color:"#52c41a",fontSize:22}})})})]}),e.jsx(S,{size:"small",style:{marginBottom:12},children:e.jsxs(E,{wrap:!0,children:[e.jsx(z,{placeholder:"角色筛选",allowClear:!0,style:{width:120},onChange:t=>A(t||""),children:k.map(t=>e.jsx(D,{value:t,children:f[t]},t))}),e.jsx(o.Search,{placeholder:"搜索用户名/姓名/邮箱",allowClear:!0,style:{width:240},onSearch:P}),e.jsx(m,{icon:e.jsx(se,{}),onClick:()=>{P(""),A("")},children:"重置"})]})}),e.jsx(le,{columns:W,dataSource:H,rowKey:"id",size:"small",pagination:{pageSize:15,showSizeChanger:!0,showTotal:t=>`共 ${t} 位用户`}}),e.jsx($,{title:n?`编辑用户：${n.displayName}`:"创建用户",open:K,onCancel:()=>p(!1),onOk:Y,confirmLoading:F,okText:"保存",cancelText:"取消",width:520,children:e.jsxs(r,{form:c,layout:"vertical",style:{marginTop:16},children:[e.jsxs(y,{gutter:12,children:[e.jsx(i,{span:12,children:e.jsx(r.Item,{name:"username",label:"用户名",rules:[{required:!0}],children:e.jsx(o,{disabled:!!n,prefix:e.jsx(_,{}),placeholder:"登录用户名"})})}),e.jsx(i,{span:12,children:e.jsx(r.Item,{name:"displayName",label:"显示名称",rules:[{required:!0}],children:e.jsx(o,{placeholder:"真实姓名/昵称"})})})]}),!n&&e.jsx(r.Item,{name:"password",label:"初始密码",rules:[{required:!0,min:6,message:"密码至少6位"}],children:e.jsx(o.Password,{placeholder:"请设置初始密码"})}),e.jsxs(y,{gutter:12,children:[e.jsx(i,{span:14,children:e.jsx(r.Item,{name:"email",label:"邮箱",rules:[{type:"email",message:"邮箱格式不正确"}],children:e.jsx(o,{placeholder:"user@example.com"})})}),e.jsx(i,{span:10,children:e.jsx(r.Item,{name:"role",label:"角色",rules:[{required:!0}],children:e.jsx(z,{placeholder:"选择角色",children:k.map(t=>e.jsx(D,{value:t,children:e.jsx(M,{color:b[t],children:f[t]})},t))})})})]}),e.jsxs(y,{gutter:12,children:[e.jsx(i,{span:12,children:e.jsx(r.Item,{name:"extensionNumber",label:"关联分机",children:e.jsx(o,{placeholder:"分机号（可选）"})})}),e.jsx(i,{span:12,children:e.jsx(r.Item,{name:"enabled",label:"账号状态",valuePropName:"checked",initialValue:!0,children:e.jsx(q,{checkedChildren:"启用",unCheckedChildren:"停用"})})})]})]})}),e.jsx($,{title:e.jsxs(e.Fragment,{children:[e.jsx(B,{})," 重置密码：",n==null?void 0:n.displayName]}),open:V,onCancel:()=>w(!1),onOk:J,confirmLoading:F,okText:"确认重置",cancelText:"取消",width:400,children:e.jsxs(r,{form:O,layout:"vertical",style:{marginTop:16},children:[e.jsx(r.Item,{name:"newPassword",label:"新密码",rules:[{required:!0,min:6,message:"密码至少6位"}],children:e.jsx(o.Password,{placeholder:"请输入新密码"})}),e.jsx(r.Item,{name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:"请再次输入密码"},({getFieldValue:t})=>({validator(a,s){return!s||t("newPassword")===s?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})],children:e.jsx(o.Password,{placeholder:"再次输入新密码"})})]})})]})};export{xe as default};
