import{a as l,j as e}from"./index-B5tky5X5.js";import{r as c}from"./vendor-DqoTkSux.js";import{N as s,T as q,y as D,S as h,B as d,a0 as V,a4 as Z,Y as L,Z as Q,K as Y,_ as G,a5 as T,M as N,R as H,O as I,ah as J,ad as u,a as p,i as U,h as g,l as W,a1 as X,a2 as R,a3 as ee,aq as A,Q as b}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const o={list:()=>l.get("/conference"),get:n=>l.get(`/conference/${n}`),create:n=>l.post("/conference",n),update:(n,i)=>l.put(`/conference/${n}`,i),delete:n=>l.delete(`/conference/${n}`),getParticipants:n=>l.get(`/conference/${n}/participants`),kickParticipant:(n,i)=>l.post(`/conference/${n}/kick`,{channel:i}),muteParticipant:(n,i)=>l.post(`/conference/${n}/mute`,{channel:i})},{Title:te,Text:ae}=q,ne=[{id:1,name:"销售晨会",extension:"8801",pin:"1234",maxParticipants:20,recordConference:!0,waitForAdmin:!1,enabled:!0,activeParticipants:3,createdAt:"2025-01-01"},{id:2,name:"高管会议",extension:"8802",pin:"9999",adminPin:"0000",maxParticipants:10,recordConference:!0,waitForAdmin:!0,enabled:!0,activeParticipants:0,createdAt:"2025-01-05"},{id:3,name:"公开会议室",extension:"8803",maxParticipants:50,recordConference:!1,waitForAdmin:!1,enabled:!0,activeParticipants:7,createdAt:"2025-01-10"}],ie=[{channel:"SIP/8001-00000001",callerIdName:"张明",callerIdNumber:"8001",joinTime:"10:15:30",muted:!1,talking:!0},{channel:"SIP/8002-00000002",callerIdName:"李华",callerIdNumber:"8002",joinTime:"10:16:00",muted:!0,talking:!1},{channel:"SIP/8003-00000003",callerIdName:"外部参与者",callerIdNumber:"13900000001",joinTime:"10:17:00",muted:!1,talking:!1}],de=()=>{const[n,i]=c.useState([]),[F,k]=c.useState(!1),[$,j]=c.useState(!1),[f,C]=c.useState(null),[m,v]=c.useState(null),[S,P]=c.useState([]),[w]=s.useForm(),y=async()=>{k(!0);try{i(await o.list())}catch{i(ne)}finally{k(!1)}};c.useEffect(()=>{y()},[]);const z=c.useCallback(async t=>{v(t);try{P(await o.getParticipants(t.id))}catch{P(t.activeParticipants?ie.slice(0,t.activeParticipants):[])}},[]),O=()=>{C(null),w.resetFields(),w.setFieldsValue({maxParticipants:20,recordConference:!1,waitForAdmin:!1,enabled:!0}),j(!0)},M=t=>{C(t),w.setFieldsValue(t),j(!0)},B=async()=>{const t=await w.validateFields();try{f?(await o.update(f.id,t),b.success("更新成功")):(await o.create(t),b.success("创建成功")),j(!1),y()}catch{const a={...t,id:Date.now(),maxParticipants:t.maxParticipants??20,recordConference:t.recordConference??!1,waitForAdmin:t.waitForAdmin??!1,enabled:t.enabled??!0,activeParticipants:0,createdAt:new Date().toISOString()};i(x=>f?x.map(r=>r.id===f.id?{...r,...t}:r):[...x,a]),j(!1)}},E=n.reduce((t,a)=>t+(a.activeParticipants??0),0),K=[{title:"会议室名称",dataIndex:"name",width:160},{title:"分机号",dataIndex:"extension",width:90,render:t=>e.jsx(p,{color:"blue",children:t})},{title:"PIN",dataIndex:"pin",width:80,render:t=>t?e.jsx(p,{children:"已设置"}):e.jsx(p,{color:"default",children:"无"})},{title:"最大参与人",dataIndex:"maxParticipants",width:100,align:"center"},{title:"当前在线",dataIndex:"activeParticipants",width:100,align:"center",render:t=>e.jsx(U,{count:t,showZero:!0,color:t>0?"#1677ff":"#d9d9d9"})},{title:"自动录音",dataIndex:"recordConference",width:90,render:t=>e.jsx(u,{checked:t,size:"small",disabled:!0})},{title:"等待主持人",dataIndex:"waitForAdmin",width:100,render:t=>e.jsx(u,{checked:t,size:"small",disabled:!0})},{title:"启用",dataIndex:"enabled",width:70,render:t=>e.jsx(u,{checked:t,size:"small",disabled:!0})},{title:"操作",key:"op",width:160,fixed:"right",render:(t,a)=>e.jsxs(h,{children:[e.jsx(g,{title:"查看参与者",children:e.jsxs(d,{size:"small",icon:e.jsx(W,{}),onClick:()=>z(a),children:[a.activeParticipants??0," 人"]})}),e.jsx(g,{title:"编辑",children:e.jsx(d,{size:"small",icon:e.jsx(X,{}),onClick:()=>M(a)})}),e.jsx(R,{title:"确认删除？",onConfirm:async()=>{try{await o.delete(a.id)}catch{}i(x=>x.filter(r=>r.id!==a.id))},children:e.jsx(d,{size:"small",danger:!0,icon:e.jsx(ee,{})})})]})}],_=[{title:"姓名",dataIndex:"callerIdName",width:120},{title:"号码",dataIndex:"callerIdNumber",width:140},{title:"加入时间",dataIndex:"joinTime",width:100},{title:"状态",key:"state",width:100,render:(t,a)=>e.jsxs(h,{children:[a.talking&&e.jsx(p,{color:"green",children:"发言中"}),a.muted&&e.jsx(p,{icon:e.jsx(A,{}),color:"orange",children:"静音"}),!a.talking&&!a.muted&&e.jsx(p,{color:"default",children:"监听"})]})},{title:"操作",key:"op",width:120,render:(t,a)=>e.jsxs(h,{children:[e.jsx(g,{title:a.muted?"取消静音":"静音",children:e.jsx(d,{size:"small",icon:e.jsx(A,{}),onClick:async()=>{try{await o.muteParticipant(m.id,a.channel)}catch{}b.success("操作成功")}})}),e.jsx(R,{title:"确认踢出该参与者？",onConfirm:async()=>{try{await o.kickParticipant(m.id,a.channel)}catch{}P(x=>x.filter(r=>r.channel!==a.channel))},children:e.jsx(d,{size:"small",danger:!0,children:"踢出"})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(te,{level:4,style:{margin:0},children:[e.jsx(D,{})," 会议室管理"]}),e.jsxs(h,{children:[e.jsx(d,{icon:e.jsx(V,{}),onClick:y,children:"刷新"}),e.jsx(d,{type:"primary",icon:e.jsx(Z,{}),onClick:O,children:"新建会议室"})]})]}),e.jsx(L,{gutter:[12,12],style:{marginBottom:16},children:[{title:"会议室总数",value:n.length,color:"#1677ff"},{title:"当前在线总人数",value:E,color:"#52c41a"},{title:"活跃会议室",value:n.filter(t=>(t.activeParticipants??0)>0).length,color:"#fa8c16"}].map(t=>e.jsx(Q,{xs:12,sm:8,children:e.jsx(Y,{size:"small",style:{borderTop:`3px solid ${t.color}`,borderRadius:8},children:e.jsx(G,{title:t.title,value:t.value,valueStyle:{color:t.color}})})},t.title))}),e.jsx(T,{columns:K,dataSource:n,rowKey:"id",loading:F,scroll:{x:900}}),e.jsx(N,{title:e.jsxs(h,{children:[e.jsx(H,{}),m==null?void 0:m.name," — 当前参与者"]}),open:!!m,footer:null,onCancel:()=>v(null),width:640,children:S.length===0?e.jsx(ae,{type:"secondary",children:"当前无参与者"}):e.jsx(T,{dataSource:S,columns:_,rowKey:"channel",size:"small",pagination:!1})}),e.jsx(N,{title:f?"编辑会议室":"新建会议室",open:$,onOk:B,onCancel:()=>j(!1),width:480,okText:"保存",cancelText:"取消",children:e.jsxs(s,{form:w,layout:"vertical",style:{marginTop:16},children:[e.jsx(s.Item,{name:"name",label:"会议室名称",rules:[{required:!0}],children:e.jsx(I,{})}),e.jsx(s.Item,{name:"extension",label:"分机号",rules:[{required:!0}],children:e.jsx(I,{placeholder:"例如：8801"})}),e.jsxs(h.Compact,{style:{width:"100%"},children:[e.jsx(s.Item,{name:"pin",label:"PIN 码",style:{width:"50%"},children:e.jsx(I.Password,{placeholder:"可选"})}),e.jsx(s.Item,{name:"adminPin",label:"管理员 PIN",style:{width:"50%"},children:e.jsx(I.Password,{placeholder:"可选"})})]}),e.jsx(s.Item,{name:"maxParticipants",label:"最大参与人数",children:e.jsx(J,{min:2,max:500,style:{width:"100%"}})}),e.jsx(s.Item,{name:"recordConference",label:"自动录音",valuePropName:"checked",children:e.jsx(u,{})}),e.jsx(s.Item,{name:"waitForAdmin",label:"等待主持人入会",valuePropName:"checked",children:e.jsx(u,{})}),e.jsx(s.Item,{name:"enabled",label:"启用",valuePropName:"checked",children:e.jsx(u,{})})]})})]})};export{de as default};
