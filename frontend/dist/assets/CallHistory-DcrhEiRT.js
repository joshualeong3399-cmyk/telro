import{a as T,j as t}from"./index-B5tky5X5.js";import{r as s}from"./vendor-DqoTkSux.js";import{U as o,T as k,K as Y,S as M,O as I,a6 as v,a7 as $,a5 as O,M as z,a as A,h as F,B as L,a8 as P}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const R={list:r=>T.get("/calls",{params:r})},{RangePicker:U}=$,g={answered:{label:"接通",color:"green"},missed:{label:"未接",color:"red"},busy:{label:"忙音",color:"orange"},failed:{label:"失败",color:"default"}},_=r=>{if(r===0)return"—";const a=Math.floor(r/60),n=r%60;return a>0?`${a}m ${String(n).padStart(2,"0")}s`:`${r}s`},B=["answered","missed","busy","answered","answered"],x=Array.from({length:55},(r,a)=>{const n=B[a%5];return{id:a+1,caller:`075588${String(1e5+a*137).slice(0,6)}`,callee:`1${["38","36","57","89"][a%4]}${String(1e7+a*1234321).slice(0,8)}`,time:o().subtract(a*28,"minute").toISOString(),duration:n==="answered"?30+a*73%270:0,status:n,recording:n==="answered"&&a%2===0?`/recordings/rec-${a+1}.wav`:null}}),N=()=>{const[r,a]=s.useState(x),[n,f]=s.useState(x.length),[w,h]=s.useState(!1),[d,c]=s.useState(1),[y,j]=s.useState(""),[u,b]=s.useState("all"),[i,C]=s.useState([o().subtract(7,"day"),o()]),[m,S]=s.useState(null),p=s.useCallback(async()=>{h(!0);try{const e=await R.list({page:d,pageSize:10,keyword:y,status:u,startDate:i[0].format("YYYY-MM-DD"),endDate:i[1].format("YYYY-MM-DD")});a(e.records),f(e.total)}catch{}finally{h(!1)}},[d,y,u,i]);s.useEffect(()=>{p()},[p]);const D=[{title:"主叫",dataIndex:"caller",key:"caller",width:140,render:e=>t.jsx("span",{style:{fontFamily:"monospace"},children:e})},{title:"被叫",dataIndex:"callee",key:"callee",width:140,render:e=>t.jsx("span",{style:{fontFamily:"monospace"},children:e})},{title:"时间",dataIndex:"time",key:"time",width:165,render:e=>o(e).format("YYYY-MM-DD HH:mm:ss"),sorter:(e,l)=>o(e.time).unix()-o(l.time).unix(),defaultSortOrder:"descend"},{title:"时长",dataIndex:"duration",key:"duration",width:90,align:"right",render:e=>_(e),sorter:(e,l)=>e.duration-l.duration},{title:"状态",dataIndex:"status",key:"status",width:80,align:"center",render:e=>t.jsx(A,{color:g[e].color,children:g[e].label})},{title:"录音",key:"recording",width:70,align:"center",render:(e,l)=>l.recording?t.jsx(F,{title:"播放录音",children:t.jsx(L,{type:"link",size:"small",icon:t.jsx(P,{}),onClick:()=>S(l.recording)})}):t.jsx("span",{style:{color:"#d9d9d9"},children:"—"})}];return t.jsxs("div",{children:[t.jsx(k.Title,{level:4,style:{marginBottom:16},children:"通话记录"}),t.jsxs(Y,{children:[t.jsxs(M,{size:8,wrap:!0,style:{marginBottom:16},children:[t.jsx(I.Search,{placeholder:"搜索主叫/被叫号码...",style:{width:240},allowClear:!0,onSearch:e=>{c(1),j(e)}}),t.jsx(v,{value:u,onChange:e=>{b(e),c(1)},style:{width:120},options:[{value:"all",label:"全部状态"},...Object.entries(g).map(([e,l])=>({value:e,label:l.label}))]}),t.jsx(U,{value:i,onChange:e=>e&&C(e),allowClear:!1,disabledDate:e=>e.isAfter(o())})]}),t.jsx(O,{dataSource:r,columns:D,rowKey:"id",loading:w,size:"middle",pagination:{current:d,pageSize:10,total:n,onChange:e=>c(e),showSizeChanger:!1,showTotal:e=>`共 ${e} 条`}})]}),t.jsx(z,{title:"录音播放",open:!!m,onCancel:()=>S(null),footer:null,width:400,destroyOnClose:!0,children:m&&t.jsx("audio",{src:m,controls:!0,autoPlay:!0,style:{width:"100%",marginTop:8}})})]})};export{N as default};
