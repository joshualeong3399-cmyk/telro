import{a as S,j as a}from"./index-B5tky5X5.js";import{r as i}from"./vendor-DqoTkSux.js";import{U as l,T,K as P,S as w,O as b,a7 as B,a5 as E,h,B as g,a8 as K,a9 as O,a2 as F,a3 as H,Q as _}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const j={list:s=>S.get("/recordings",{params:s}),remove:s=>S.delete(`/recordings/${s}`)},{RangePicker:A}=B,L=s=>{const n=Math.floor(s/60),o=s%60;return n>0?`${n}m ${String(o).padStart(2,"0")}s`:`${s}s`},G=s=>s>=1024*1024?`${(s/1024/1024).toFixed(1)} MB`:`${(s/1024).toFixed(0)} KB`,D=Array.from({length:42},(s,n)=>{const o=30+n*73%350,r=l().subtract(n*43,"minute");return{id:n+1,filename:`${r.format("YYYYMMDD-HHmmss")}-0755881${String(1e3+n).slice(1)}-138${String(1e7+n*1234321).slice(0,8)}.wav`,duration:o,size:o*8e3,time:r.toISOString(),url:`/recordings/rec-${n+1}.wav`}}),J=()=>{const[s,n]=i.useState(D),[o,r]=i.useState(D.length),[z,p]=i.useState(!1),[m,f]=i.useState(1),[x,Y]=i.useState(""),[c,k]=i.useState([l().subtract(7,"day"),l()]),[d,u]=i.useState(null),y=i.useCallback(async()=>{p(!0);try{const e=await j.list({page:m,pageSize:10,keyword:x,startDate:c[0].format("YYYY-MM-DD"),endDate:c[1].format("YYYY-MM-DD")});n(e.records),r(e.total)}catch{}finally{p(!1)}},[m,x,c]);i.useEffect(()=>{y()},[y]);const C=async e=>{try{await j.remove(e)}catch{}n(t=>t.filter(v=>v.id!==e)),d===e&&u(null),r(t=>t-1),_.success("删除成功")},M=e=>{const t=document.createElement("a");t.href=e.url,t.download=e.filename,document.body.appendChild(t),t.click(),document.body.removeChild(t)},R=e=>u(t=>t===e?null:e),$=[{title:"文件名",dataIndex:"filename",key:"filename",ellipsis:{showTitle:!1},render:e=>a.jsx(h,{title:e,placement:"topLeft",children:a.jsx("span",{style:{fontFamily:"monospace",fontSize:12},children:e})})},{title:"时长",dataIndex:"duration",key:"duration",width:90,align:"right",render:e=>L(e),sorter:(e,t)=>e.duration-t.duration},{title:"大小",dataIndex:"size",key:"size",width:90,align:"right",render:e=>G(e),sorter:(e,t)=>e.size-t.size},{title:"时间",dataIndex:"time",key:"time",width:165,render:e=>l(e).format("YYYY-MM-DD HH:mm:ss"),sorter:(e,t)=>l(e.time).unix()-l(t.time).unix(),defaultSortOrder:"descend"},{title:"操作",key:"action",width:170,align:"center",render:(e,t)=>a.jsxs(w,{size:0,children:[a.jsx(h,{title:d===t.id?"收起播放器":"播放",children:a.jsx(g,{type:"link",size:"small",icon:a.jsx(K,{}),onClick:()=>R(t.id),children:d===t.id?"收起":"播放"})}),a.jsx(h,{title:"下载",children:a.jsx(g,{type:"link",size:"small",icon:a.jsx(O,{}),onClick:()=>M(t),children:"下载"})}),a.jsx(F,{title:"确定删除该录音文件？",onConfirm:()=>C(t.id),children:a.jsx(g,{type:"link",size:"small",danger:!0,icon:a.jsx(H,{}),children:"删除"})})]})}],I=e=>a.jsx("div",{style:{padding:"8px 48px"},children:a.jsx("audio",{src:e.url,controls:!0,autoPlay:!0,style:{width:"100%"}},e.id)});return a.jsxs("div",{children:[a.jsx(T.Title,{level:4,style:{marginBottom:16},children:"录音管理"}),a.jsxs(P,{children:[a.jsxs(w,{size:8,wrap:!0,style:{marginBottom:16},children:[a.jsx(b.Search,{placeholder:"搜索文件名...",style:{width:280},allowClear:!0,onSearch:e=>{f(1),Y(e)}}),a.jsx(A,{value:c,onChange:e=>e&&k(e),allowClear:!1,disabledDate:e=>e.isAfter(l())})]}),a.jsx(E,{dataSource:s,columns:$,rowKey:"id",loading:z,size:"middle",expandable:{expandedRowKeys:d!==null?[d]:[],expandedRowRender:I,showExpandColumn:!1},pagination:{current:m,pageSize:10,total:o,onChange:e=>{f(e),u(null)},showSizeChanger:!1,showTotal:e=>`共 ${e} 条`}})]})]})};export{J as default};
