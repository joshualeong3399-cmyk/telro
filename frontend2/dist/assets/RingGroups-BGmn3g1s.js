import{a as c,j as e}from"./index-B5tky5X5.js";import{r as i}from"./vendor-DqoTkSux.js";import{N as a,T as K,s as B,S as f,B as x,a0 as L,a4 as M,a5 as z,M as G,O as u,a6 as C,ah as V,ap as _,ad as T,a as h,h as q,a1 as P,a2 as Q,a3 as X,Q as v}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const p={list:()=>c.get("/ring-groups"),get:n=>c.get(`/ring-groups/${n}`),create:n=>c.post("/ring-groups",n),update:(n,r)=>c.put(`/ring-groups/${n}`,r),delete:n=>c.delete(`/ring-groups/${n}`)},{Title:Y}=K,{Option:H}=C,k={ringall:"同时振铃",hunt:"顺序振铃",memoryhunt:"记忆顺序",firstavailable:"第一个空闲",random:"随机"},J=[{id:1,name:"销售组A",extension:"7001",strategy:"ringall",ringTimeout:30,members:[{extensionId:1,extensionNumber:"8001",name:"张明",order:1},{extensionId:2,extensionNumber:"8002",name:"李华",order:2}],enabled:!0,createdAt:"2025-01-01"},{id:2,name:"客服组",extension:"7002",strategy:"hunt",ringTimeout:20,members:[{extensionId:3,extensionNumber:"8003",name:"王芳",order:1}],enabled:!0,createdAt:"2025-01-05"},{id:3,name:"技术支持",extension:"7003",strategy:"random",ringTimeout:25,members:[],enabled:!1,failoverDestination:"9000",createdAt:"2025-01-10"}],U=[{key:"1",title:"8001 - 张明"},{key:"2",title:"8002 - 李华"},{key:"3",title:"8003 - 王芳"},{key:"4",title:"8004 - 陈刚"},{key:"5",title:"8005 - 刘梅"}],se=()=>{const[n,r]=i.useState([]),[A,I]=i.useState(!1),[E,l]=i.useState(!1),[d,w]=i.useState(null),[N,R]=i.useState([]),[S,g]=i.useState([]),[o]=a.useForm(),j=async()=>{I(!0);try{r(await p.list())}catch{r(J)}finally{I(!1)}};i.useEffect(()=>{j()},[]);const O=()=>{w(null),o.resetFields(),o.setFieldsValue({strategy:"ringall",ringTimeout:30,enabled:!0}),g([]),l(!0)},F=t=>{w(t),o.setFieldsValue(t),g(t.members.map(s=>String(s.extensionId))),l(!0)},$=async()=>{const s={...await o.validateFields(),memberIds:S.map(Number)};try{d?(await p.update(d.id,s),v.success("更新成功")):(await p.create(s),v.success("创建成功")),l(!1),j()}catch{const y={...s,id:Date.now(),members:[],enabled:s.enabled??!0,createdAt:new Date().toISOString()};r(m=>d?m.map(b=>b.id===d.id?{...b,...s}:b):[...m,y]),l(!1)}},D=[{title:"名称",dataIndex:"name",width:160},{title:"分机号",dataIndex:"extension",width:90,render:t=>e.jsx(h,{color:"blue",children:t})},{title:"振铃策略",dataIndex:"strategy",width:120,render:t=>e.jsx(h,{children:k[t]})},{title:"超时（秒）",dataIndex:"ringTimeout",width:100,align:"center"},{title:"成员",dataIndex:"members",width:220,render:t=>t.length>0?t.map(s=>e.jsxs(h,{children:[s.extensionNumber," ",s.name]},s.extensionId)):e.jsx(h,{color:"default",children:"无成员"})},{title:"溢出目标",dataIndex:"failoverDestination",width:100,render:t=>t??"-"},{title:"启用",dataIndex:"enabled",width:70,render:t=>e.jsx(T,{checked:t,size:"small",disabled:!0})},{title:"操作",key:"op",width:100,fixed:"right",render:(t,s)=>e.jsxs(f,{children:[e.jsx(q,{title:"编辑",children:e.jsx(x,{size:"small",icon:e.jsx(P,{}),onClick:()=>F(s)})}),e.jsx(Q,{title:"确认删除？",onConfirm:async()=>{try{await p.delete(s.id)}catch{}r(y=>y.filter(m=>m.id!==s.id))},children:e.jsx(x,{size:"small",danger:!0,icon:e.jsx(X,{})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(Y,{level:4,style:{margin:0},children:[e.jsx(B,{})," 振铃组管理"]}),e.jsxs(f,{children:[e.jsx(x,{icon:e.jsx(L,{}),onClick:j,children:"刷新"}),e.jsx(x,{type:"primary",icon:e.jsx(M,{}),onClick:O,children:"新建振铃组"})]})]}),e.jsx(z,{columns:D,dataSource:n,rowKey:"id",loading:A,scroll:{x:900}}),e.jsx(G,{title:d?"编辑振铃组":"新建振铃组",open:E,onOk:$,onCancel:()=>l(!1),width:620,okText:"保存",cancelText:"取消",children:e.jsxs(a,{form:o,layout:"vertical",style:{marginTop:16},children:[e.jsx(a.Item,{name:"name",label:"振铃组名称",rules:[{required:!0}],children:e.jsx(u,{})}),e.jsx(a.Item,{name:"extension",label:"分机号",rules:[{required:!0}],children:e.jsx(u,{placeholder:"例如：7001"})}),e.jsxs(f.Compact,{style:{width:"100%"},children:[e.jsx(a.Item,{name:"strategy",label:"振铃策略",style:{width:"60%"},children:e.jsx(C,{children:Object.entries(k).map(([t,s])=>e.jsx(H,{value:t,children:s},t))})}),e.jsx(a.Item,{name:"ringTimeout",label:"超时（秒）",style:{width:"40%"},children:e.jsx(V,{min:5,max:120,style:{width:"100%"}})})]}),e.jsx(a.Item,{label:"成员分机",children:e.jsx(_,{dataSource:U,titles:["可用分机","已选成员"],targetKeys:S,selectedKeys:N,onChange:t=>g(t),onSelectChange:(t,s)=>R([...t,...s]),render:t=>t.title??t.key,listStyle:{width:220,height:200}})}),e.jsx(a.Item,{name:"failoverDestination",label:"溢出目标（可选）",children:e.jsx(u,{placeholder:"分机号/队列名"})}),e.jsx(a.Item,{name:"description",label:"备注",children:e.jsx(u,{})}),e.jsx(a.Item,{name:"enabled",label:"启用",valuePropName:"checked",children:e.jsx(T,{})})]})})]})};export{se as default};
