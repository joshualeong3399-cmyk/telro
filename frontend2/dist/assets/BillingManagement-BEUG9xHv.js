import{a as C,j as e}from"./index-B5tky5X5.js";import{r as x}from"./vendor-DqoTkSux.js";import{U as c,T as Y,K as y,aa as N,Y as $,Z as f,_ as p,R as O,$ as B,H as L,z as _,a5 as h,S,a6 as A,a7 as E,a as K}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const R={getSummary:r=>C.get("/billing/summary",{params:{month:r}}),getRecords:r=>C.get("/billing/records",{params:r})},{Text:i}=Y,{RangePicker:P}=E,u=r=>r.toLocaleString("zh-CN"),g=r=>r.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),b=r=>`${r.toFixed(1)}%`,W=r=>{const s=Math.floor(r/60),n=r%60;return`${s}m ${String(n).padStart(2,"0")}s`},H=()=>{const r=c();return Array.from({length:19},(s,n)=>{const o=800+Math.floor(Math.random()*600),t=Math.floor(o*(.8+Math.random()*.15)),l=Math.floor(t*(3+Math.random()*3));return{date:r.subtract(18-n,"day").format("YYYY-MM-DD"),calls:o,answered:t,answerRate:parseFloat((t/o*100).toFixed(1)),duration:l,cost:parseFloat((l*.1).toFixed(2))}})},D=H(),G=r=>{const s=r.reduce((l,d)=>l+d.calls,0),n=r.reduce((l,d)=>l+d.answered,0),o=r.reduce((l,d)=>l+d.duration,0),t=parseFloat(r.reduce((l,d)=>l+d.cost,0).toFixed(2));return{totalCalls:s,answeredCalls:n,answerRate:parseFloat((n/s*100).toFixed(1)),totalDuration:o,totalSpend:t}},U=["minute","count"],Z={minute:"分钟计费",count:"次数计费"},q={minute:"blue",count:"purple"},J=()=>Array.from({length:60},(r,s)=>{const n=U[s%2],o=30+Math.floor(Math.random()*300);return{id:s+1,time:c().subtract(s*23,"minute").toISOString(),billingType:n,callerNumber:`0755${String(1e7+Math.floor(Math.random()*89999999)).slice(0,8)}`,calleeNumber:`1${["3","5","7","8"][s%4]}${String(Math.floor(Math.random()*1e9)).padStart(9,"0")}`,duration:o,cost:parseFloat((n==="minute"?Math.ceil(o/60)*.1:.05).toFixed(2))}}),Q=J(),V=({summary:r})=>e.jsxs($,{gutter:16,style:{marginBottom:16},children:[e.jsx(f,{xs:24,sm:12,xl:6,children:e.jsx(y,{styles:{body:{padding:"20px 24px"}},style:{borderTop:"3px solid #1677ff"},children:e.jsx(p,{title:"本月拨打次数",value:r.totalCalls,prefix:e.jsx(O,{style:{color:"#1677ff"}}),formatter:s=>u(Number(s)),valueStyle:{color:"#1677ff",fontWeight:700}})})}),e.jsx(f,{xs:24,sm:12,xl:6,children:e.jsx(y,{styles:{body:{padding:"20px 24px"}},style:{borderTop:"3px solid #52c41a"},children:e.jsx(p,{title:"接通次数",value:r.answeredCalls,prefix:e.jsx(B,{style:{color:"#52c41a"}}),formatter:s=>u(Number(s)),valueStyle:{color:"#52c41a",fontWeight:700},suffix:e.jsxs(i,{style:{fontSize:13,fontWeight:400,color:"#52c41a",marginLeft:6},children:["(",b(r.answerRate),")"]})})})}),e.jsx(f,{xs:24,sm:12,xl:6,children:e.jsx(y,{styles:{body:{padding:"20px 24px"}},style:{borderTop:"3px solid #fa8c16"},children:e.jsx(p,{title:"通话时长（分钟）",value:r.totalDuration,prefix:e.jsx(L,{style:{color:"#fa8c16"}}),formatter:s=>u(Number(s)),valueStyle:{color:"#fa8c16",fontWeight:700},suffix:"min"})})}),e.jsx(f,{xs:24,sm:12,xl:6,children:e.jsx(y,{styles:{body:{padding:"20px 24px"}},style:{borderTop:"3px solid #f5222d"},children:e.jsx(p,{title:"本月消费金额",value:r.totalSpend,prefix:e.jsx(_,{style:{color:"#f5222d"}}),precision:2,formatter:s=>g(Number(s)),valueStyle:{color:"#f5222d",fontWeight:700},suffix:"元"})})})]}),X=({daily:r,summary:s})=>{const n=[{title:"日期",dataIndex:"date",key:"date",width:120,render:t=>e.jsx(i,{children:t})},{title:"拨打量",dataIndex:"calls",key:"calls",align:"right",render:t=>u(t),sorter:(t,l)=>t.calls-l.calls},{title:"接通量",dataIndex:"answered",key:"answered",align:"right",render:t=>u(t),sorter:(t,l)=>t.answered-l.answered},{title:"接通率",dataIndex:"answerRate",key:"answerRate",align:"right",render:t=>e.jsx(i,{style:{color:t>=85?"#52c41a":t>=70?"#fa8c16":"#f5222d"},children:b(t)}),sorter:(t,l)=>t.answerRate-l.answerRate},{title:"通话时长(分钟)",dataIndex:"duration",key:"duration",align:"right",render:t=>u(t),sorter:(t,l)=>t.duration-l.duration},{title:"费用(元)",dataIndex:"cost",key:"cost",align:"right",render:t=>e.jsx(i,{strong:!0,children:g(t)}),sorter:(t,l)=>t.cost-l.cost}],o=()=>e.jsxs(h.Summary.Row,{style:{background:"#fafafa"},children:[e.jsx(h.Summary.Cell,{index:0,children:e.jsx(i,{strong:!0,children:"合计"})}),e.jsx(h.Summary.Cell,{index:1,align:"right",children:e.jsx(i,{strong:!0,children:u(s.totalCalls)})}),e.jsx(h.Summary.Cell,{index:2,align:"right",children:e.jsx(i,{strong:!0,children:u(s.answeredCalls)})}),e.jsx(h.Summary.Cell,{index:3,align:"right",children:e.jsx(i,{strong:!0,style:{color:"#52c41a"},children:b(s.answerRate)})}),e.jsx(h.Summary.Cell,{index:4,align:"right",children:e.jsx(i,{strong:!0,children:u(s.totalDuration)})}),e.jsx(h.Summary.Cell,{index:5,align:"right",children:e.jsxs(i,{strong:!0,style:{color:"#f5222d"},children:["¥ ",g(s.totalSpend)]})})]});return e.jsx(h,{dataSource:r,columns:n,rowKey:"date",size:"middle",pagination:{pageSize:20,showSizeChanger:!1,showTotal:t=>`共 ${t} 条`},summary:o,scroll:{x:700}})},ee=({records:r,loading:s,billingType:n,dateRange:o,onTypeChange:t,onDateChange:l})=>{const d=x.useMemo(()=>r.filter(a=>(n==="all"||a.billingType===n)&&c(a.time).isAfter(o[0].startOf("day"))&&c(a.time).isBefore(o[1].endOf("day"))),[r,n,o]),j=[{title:"时间",dataIndex:"time",key:"time",width:170,render:a=>c(a).format("YYYY-MM-DD HH:mm:ss"),sorter:(a,m)=>c(a.time).unix()-c(m.time).unix(),defaultSortOrder:"descend"},{title:"计费类型",dataIndex:"billingType",key:"billingType",width:110,align:"center",render:a=>e.jsx(K,{color:q[a],children:Z[a]})},{title:"主叫号码",dataIndex:"callerNumber",key:"callerNumber",width:140,render:a=>e.jsx(i,{code:!0,style:{fontSize:12},children:a})},{title:"被叫号码",dataIndex:"calleeNumber",key:"calleeNumber",width:140,render:a=>e.jsx(i,{code:!0,style:{fontSize:12},children:a})},{title:"通话时长",dataIndex:"duration",key:"duration",width:110,align:"right",render:a=>W(a),sorter:(a,m)=>a.duration-m.duration},{title:"费用(元)",dataIndex:"cost",key:"cost",width:100,align:"right",render:a=>e.jsx(i,{strong:!0,style:{color:"#f5222d"},children:g(a)}),sorter:(a,m)=>a.cost-m.cost}];return e.jsxs(e.Fragment,{children:[e.jsxs(S,{size:12,wrap:!0,style:{marginBottom:16},children:[e.jsxs(S,{children:[e.jsx(i,{type:"secondary",children:"计费类型："}),e.jsx(A,{value:n,onChange:t,style:{width:140},options:[{value:"all",label:"全部"},{value:"minute",label:"分钟计费"},{value:"count",label:"次数计费"}]})]}),e.jsxs(S,{children:[e.jsx(i,{type:"secondary",children:"时间范围："}),e.jsx(P,{value:o,onChange:a=>a&&l(a),allowClear:!1,disabledDate:a=>a.isAfter(c())})]}),e.jsxs(i,{type:"secondary",style:{fontSize:12},children:["共 ",e.jsx(i,{strong:!0,children:u(d.length)})," 条记录， 合计费用 ",e.jsxs(i,{strong:!0,style:{color:"#f5222d"},children:["¥ ",g(d.reduce((a,m)=>a+m.cost,0))]})]})]}),e.jsx(h,{dataSource:d,columns:j,rowKey:"id",loading:s,size:"middle",pagination:{pageSize:15,showSizeChanger:!0,showTotal:a=>`共 ${a} 条`},scroll:{x:780}})]})},ne=()=>{const r=c().format("YYYY-MM"),[s,n]=x.useState(G(D)),[o,t]=x.useState(D),[l,d]=x.useState(Q),[j,a]=x.useState(!1),[m,I]=x.useState("all"),[T,k]=x.useState([c().startOf("month"),c()]);x.useEffect(()=>{(async()=>{a(!0);try{const[M,z]=await Promise.all([R.getSummary(r),R.getRecords({startDate:c().startOf("month").format("YYYY-MM-DD"),endDate:c().format("YYYY-MM-DD")})]);n(M.summary),t(M.dailyStats),d(z.records)}catch{}finally{a(!1)}})()},[r]);const w=x.useMemo(()=>s,[s]),v=x.useMemo(()=>o,[o]),F=[{key:"daily",label:"拨打统计",children:e.jsx("div",{style:{padding:"16px 0"},children:e.jsx(X,{daily:v,summary:w})})},{key:"records",label:"账单明细",children:e.jsx("div",{style:{padding:"16px 0"},children:e.jsx(ee,{records:l,loading:j,billingType:m,dateRange:T,onTypeChange:I,onDateChange:k})})}];return e.jsxs("div",{children:[e.jsx(Y.Title,{level:4,style:{marginBottom:16},children:"计费管理"}),e.jsx(V,{summary:w}),e.jsx(y,{styles:{body:{padding:"0 24px 24px"}},children:e.jsx(N,{defaultActiveKey:"daily",items:F})})]})};export{ne as default};
