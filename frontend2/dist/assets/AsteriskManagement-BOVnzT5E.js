import{a as i,j as s}from"./index-B5tky5X5.js";import{r as a}from"./vendor-DqoTkSux.js";import{T as Q,I as V,S as g,B as d,a0 as X,at as b,am as w,Y as O,Z as x,K as h,D as u,a as z,i as Z,au as G,av as J,X as N,aw as W,$ as B,ak as L,H as ss,ax as T,M as es,O as ts,Q as j}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const y={getStatus:()=>i.get("/asterisk/status"),syncAll:()=>i.post("/asterisk/sync/all"),syncModule:t=>i.post(`/asterisk/sync/${t}`),reloadModule:t=>i.post("/asterisk/reload",{module:t}),runCommand:t=>i.post("/asterisk/command",{command:t})},{Title:ns,Text:c}=Q,r={extensions:"分机",trunks:"SIP 中继",queues:"呼叫队列",ivr:"IVR 菜单",routes:"路由规则"},as={version:"Asterisk 20.5.0",uptime:"3 days, 14:22:10",activeCalls:8,peersOnline:12,peersTotal:15,channelsActive:9},is=()=>{const[t,S]=a.useState(null),[E,k]=a.useState(!1),[F,C]=a.useState(!1),[P,I]=a.useState(null),[p,o]=a.useState([]),[D,v]=a.useState(!1),[m,H]=a.useState(""),[_,f]=a.useState(""),[K,A]=a.useState(!1),R=async()=>{k(!0);try{S(await y.getStatus())}catch{S(as)}finally{k(!1)}};a.useEffect(()=>{R()},[]);const U=async()=>{C(!0),o([]);try{const e=await y.syncAll();o(e),j.success(`全量同步完成，${e.filter(n=>n.status==="success").length}/${e.length} 成功`)}catch{const e=Object.entries(r).map(([n,l])=>({module:l,status:"success",message:"同步成功",duration:Math.floor(Math.random()*500+100)}));o(e),j.success("全量同步完成（演示）")}finally{C(!1)}},Y=async e=>{I(e);try{const n=await y.syncModule(e);o(l=>[n,...l.filter(q=>q.module!==n.module)]),j.success(`${r[e]} 同步成功`)}catch{const n={module:r[e],status:"success",message:"同步成功（演示）",duration:320};o(l=>[n,...l]),j.success(`${r[e]} 同步成功（演示）`)}finally{I(null)}},M=async()=>{if(m.trim()){A(!0),f("");try{const e=await y.runCommand(m);f(e.output)}catch{f(`Asterisk CLI 演示模式
> ${m}
Command output would appear here in production.`)}finally{A(!1)}}},$=t?Math.round(t.peersOnline/t.peersTotal*100):0;return s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[s.jsxs(ns,{level:4,style:{margin:0},children:[s.jsx(V,{})," Asterisk 管理与同步"]}),s.jsxs(g,{children:[s.jsx(d,{icon:s.jsx(X,{}),onClick:R,children:"刷新状态"}),s.jsx(d,{icon:s.jsx(b,{}),onClick:()=>v(!0),children:"CLI 命令"}),s.jsx(d,{type:"primary",icon:s.jsx(w,{}),loading:F,onClick:U,children:"全量同步"})]})]}),s.jsxs(O,{gutter:[16,16],children:[s.jsx(x,{xs:24,lg:10,children:s.jsx(h,{title:s.jsxs(s.Fragment,{children:[s.jsx(W,{})," Asterisk 状态"]}),loading:E,children:t?s.jsxs(s.Fragment,{children:[s.jsxs(u,{column:1,size:"small",children:[s.jsx(u.Item,{label:"版本",children:s.jsx(z,{color:"blue",children:t.version})}),s.jsx(u.Item,{label:"运行时间",children:t.uptime}),s.jsxs(u.Item,{label:"活跃通话",children:[s.jsx(Z,{count:t.activeCalls,color:"#1677ff"})," 路"]}),s.jsx(u.Item,{label:"活跃信道",children:t.channelsActive})]}),s.jsx(G,{style:{margin:"12px 0"}}),s.jsxs("div",{style:{marginBottom:8},children:[s.jsx(c,{type:"secondary",children:"SIP 注册率"}),s.jsx(J,{percent:$,format:()=>`${t.peersOnline}/${t.peersTotal}`,strokeColor:$>=80?"#52c41a":"#fa8c16"})]})]}):s.jsx(N,{message:"无法连接 Asterisk",type:"error"})})}),s.jsx(x,{xs:24,lg:14,children:s.jsx(h,{title:s.jsxs(s.Fragment,{children:[s.jsx(w,{})," 模块同步"]}),children:s.jsx(O,{gutter:[8,8],children:Object.keys(r).map(e=>{const n=p.find(l=>l.module===r[e]);return s.jsx(x,{xs:12,sm:8,children:s.jsxs(h,{size:"small",style:{textAlign:"center",borderRadius:8,cursor:"pointer"},styles:{body:{padding:12}},children:[s.jsx("div",{style:{marginBottom:8},children:n?n.status==="success"?s.jsx(B,{style:{fontSize:24,color:"#52c41a"}}):s.jsx(L,{style:{fontSize:24,color:"#ff4d4f"}}):s.jsx(ss,{style:{fontSize:24,color:"#d9d9d9"}})}),s.jsx(c,{strong:!0,style:{display:"block",marginBottom:8},children:r[e]}),n&&s.jsxs(c,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:6},children:[n.duration,"ms"]}),s.jsx(d,{size:"small",type:"dashed",loading:P===e,onClick:()=>Y(e),block:!0,children:"同步"})]})},e)})})})}),p.length>0&&s.jsx(x,{xs:24,children:s.jsx(h,{title:"同步结果",size:"small",children:s.jsx(T,{size:"small",dataSource:p,renderItem:e=>s.jsx(T.Item,{children:s.jsxs(g,{children:[e.status==="success"?s.jsx(B,{style:{color:"#52c41a"}}):s.jsx(L,{style:{color:"#ff4d4f"}}),s.jsx(c,{strong:!0,children:e.module}),s.jsx(c,{type:"secondary",children:e.message}),s.jsxs(z,{children:[e.duration,"ms"]})]})})})})})]}),s.jsxs(es,{title:s.jsxs(s.Fragment,{children:[s.jsx(b,{})," Asterisk CLI"]}),open:D,onCancel:()=>v(!1),footer:null,width:640,children:[s.jsxs(g.Compact,{style:{width:"100%",marginBottom:12},children:[s.jsx(ts,{placeholder:"输入 Asterisk CLI 命令，如 core show channels",value:m,onChange:e=>H(e.target.value),onPressEnter:M}),s.jsx(d,{type:"primary",loading:K,onClick:M,children:"执行"})]}),s.jsx("div",{style:{background:"#001529",color:"#00ff00",padding:16,borderRadius:8,minHeight:200,fontFamily:"monospace",fontSize:13,whiteSpace:"pre-wrap",overflowY:"auto",maxHeight:360},children:_||s.jsx(c,{style:{color:"#666"},children:"等待命令输入..."})})]})]})};export{is as default};
