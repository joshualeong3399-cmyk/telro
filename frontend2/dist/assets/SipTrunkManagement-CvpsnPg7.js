import{a as r,j as e}from"./index-B5tky5X5.js";import{r as d}from"./vendor-DqoTkSux.js";import{N as l,T as A,G as B,S as k,B as h,a0 as N,a4 as K,Y as p,Z as n,K as q,_ as H,a5 as L,M as U,O as m,ah as T,a6 as b,ad as $,a as j,$ as V,ak as _,h as G,a1 as Q,a2 as Y,a3 as Z,Q as g}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const I={list:()=>r.get("/sip-trunks"),get:t=>r.get(`/sip-trunks/${t}`),create:t=>r.post("/sip-trunks",t),update:(t,i)=>r.put(`/sip-trunks/${t}`,i),delete:t=>r.delete(`/sip-trunks/${t}`),reload:t=>r.post(`/sip-trunks/${t}/reload`),testConnection:t=>r.post(`/sip-trunks/${t}/test`)},{Title:J}=A,{Option:w}=b,W=[{id:1,name:"主干线1",host:"sip.provider.com",port:5060,username:"user01",transport:"udp",codecs:["alaw","ulaw","g729"],maxChannels:30,status:"registered",enabled:!0,createdAt:"2025-01-01"},{id:2,name:"备用干线",host:"sip2.provider.com",port:5060,username:"user02",transport:"tcp",codecs:["alaw","ulaw"],maxChannels:10,status:"unregistered",enabled:!1,createdAt:"2025-01-10"},{id:3,name:"国际线路",host:"192.168.1.100",port:5080,transport:"udp",codecs:["alaw"],maxChannels:5,status:"registered",enabled:!0,createdAt:"2025-01-15"}],X=["alaw","ulaw","g729","g722","gsm","h264"],le=()=>{const[t,i]=d.useState([]),[R,C]=d.useState(!1),[P,c]=d.useState(!1),[o,v]=d.useState(null),[O,S]=d.useState(null),[u]=l.useForm(),y=async()=>{C(!0);try{i(await I.list())}catch{i(W)}finally{C(!1)}};d.useEffect(()=>{y()},[]);const F=()=>{v(null),u.resetFields(),u.setFieldsValue({port:5060,transport:"udp",codecs:["alaw","ulaw"],maxChannels:30,enabled:!0}),c(!0)},E=s=>{v(s),u.setFieldsValue(s),c(!0)},M=async()=>{const s=await u.validateFields();try{o?(await I.update(o.id,s),g.success("更新成功")):(await I.create(s),g.success("创建成功")),c(!1),y()}catch{const a={...s,id:Date.now(),status:"unknown",createdAt:new Date().toISOString(),port:s.port??5060,transport:s.transport??"udp",codecs:s.codecs??[],maxChannels:s.maxChannels??30,enabled:s.enabled??!0};i(f=>o?f.map(x=>x.id===o.id?{...x,...s}:x):[...f,a]),c(!1)}},z=async s=>{S(s);try{const a=await I.testConnection(s);a.success?g.success(`连接成功：${a.message}`):g.error(`连接失败：${a.message}`)}catch{g.success("连接测试成功（演示）")}finally{S(null)}},D=[{title:"名称",dataIndex:"name",width:140},{title:"Host",dataIndex:"host",width:180},{title:"端口",dataIndex:"port",width:70,align:"center"},{title:"协议",dataIndex:"transport",width:70,render:s=>e.jsx(j,{children:s.toUpperCase()})},{title:"编解码",dataIndex:"codecs",width:180,render:s=>s.map(a=>e.jsx(j,{children:a},a))},{title:"最大信道",dataIndex:"maxChannels",width:90,align:"center"},{title:"注册状态",dataIndex:"status",width:100,render:s=>s==="registered"?e.jsx(j,{icon:e.jsx(V,{}),color:"success",children:"已注册"}):s==="unregistered"?e.jsx(j,{icon:e.jsx(_,{}),color:"error",children:"未注册"}):e.jsx(j,{color:"default",children:"未知"})},{title:"启用",dataIndex:"enabled",width:70,render:s=>e.jsx($,{checked:s,size:"small",disabled:!0})},{title:"操作",key:"actions",width:200,fixed:"right",render:(s,a)=>e.jsxs(k,{children:[e.jsx(h,{size:"small",loading:O===a.id,onClick:()=>z(a.id),children:"测试"}),e.jsx(G,{title:"编辑",children:e.jsx(h,{size:"small",icon:e.jsx(Q,{}),onClick:()=>E(a)})}),e.jsx(Y,{title:"确认删除此中继？",onConfirm:async()=>{try{await I.delete(a.id)}catch{}i(f=>f.filter(x=>x.id!==a.id))},children:e.jsx(h,{size:"small",danger:!0,icon:e.jsx(Z,{})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(J,{level:4,style:{margin:0},children:[e.jsx(B,{})," SIP 中继管理"]}),e.jsxs(k,{children:[e.jsx(h,{icon:e.jsx(N,{}),onClick:y,children:"刷新"}),e.jsx(h,{type:"primary",icon:e.jsx(K,{}),onClick:F,children:"新增中继"})]})]}),e.jsx(p,{gutter:[12,12],style:{marginBottom:16},children:[{title:"总中继数",value:t.length,color:"#1677ff"},{title:"已注册",value:t.filter(s=>s.status==="registered").length,color:"#52c41a"},{title:"已启用",value:t.filter(s=>s.enabled).length,color:"#13c2c2"},{title:"最大信道数",value:t.reduce((s,a)=>s+a.maxChannels,0),color:"#722ed1"}].map(s=>e.jsx(n,{xs:12,sm:6,children:e.jsx(q,{size:"small",style:{borderTop:`3px solid ${s.color}`,borderRadius:8},children:e.jsx(H,{title:s.title,value:s.value,valueStyle:{color:s.color}})})},s.title))}),e.jsx(L,{columns:D,dataSource:t,rowKey:"id",loading:R,scroll:{x:900}}),e.jsx(U,{title:o?"编辑 SIP 中继":"新增 SIP 中继",open:P,onOk:M,onCancel:()=>c(!1),width:580,okText:"保存",cancelText:"取消",children:e.jsxs(l,{form:u,layout:"vertical",style:{marginTop:16},children:[e.jsx(l.Item,{name:"name",label:"中继名称",rules:[{required:!0}],children:e.jsx(m,{})}),e.jsxs(p,{gutter:12,children:[e.jsx(n,{span:16,children:e.jsx(l.Item,{name:"host",label:"SIP Host",rules:[{required:!0}],children:e.jsx(m,{placeholder:"sip.provider.com 或 IP"})})}),e.jsx(n,{span:8,children:e.jsx(l.Item,{name:"port",label:"端口",children:e.jsx(T,{min:1,max:65535,style:{width:"100%"}})})})]}),e.jsxs(p,{gutter:12,children:[e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"username",label:"用户名",children:e.jsx(m,{})})}),e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"secret",label:"密码",children:e.jsx(m.Password,{})})})]}),e.jsxs(p,{gutter:12,children:[e.jsx(n,{span:8,children:e.jsx(l.Item,{name:"transport",label:"传输协议",children:e.jsxs(b,{children:[e.jsx(w,{value:"udp",children:"UDP"}),e.jsx(w,{value:"tcp",children:"TCP"}),e.jsx(w,{value:"tls",children:"TLS"})]})})}),e.jsx(n,{span:16,children:e.jsx(l.Item,{name:"codecs",label:"编解码",children:e.jsx(b,{mode:"multiple",children:X.map(s=>e.jsx(w,{value:s,children:s},s))})})})]}),e.jsxs(p,{gutter:12,children:[e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"callerIdNumber",label:"主叫号码",children:e.jsx(m,{placeholder:"可选"})})}),e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"maxChannels",label:"最大信道数",children:e.jsx(T,{min:1,max:1e3,style:{width:"100%"}})})})]}),e.jsx(l.Item,{name:"enabled",label:"启用",valuePropName:"checked",children:e.jsx($,{})})]})})]})};export{le as default};
