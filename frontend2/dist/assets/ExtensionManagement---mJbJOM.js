import{a as u,j as t}from"./index-B5tky5X5.js";import{r}from"./vendor-DqoTkSux.js";import{N as i,a as k,S as q,B as x,a1 as B,a2 as D,a3 as K,T as X,K as J,O as y,a4 as V,a5 as Y,M as G,a6 as v,Q as g}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const m={list:l=>u.get("/extensions",{params:l}),create:l=>u.post("/extensions",l),update:(l,s)=>u.put(`/extensions/${l}`,s),remove:l=>u.delete(`/extensions/${l}`)},Q={SIP:"blue",PJSIP:"cyan",IAX:"purple"},f={registered:{label:"已注册",color:"green"},unregistered:{label:"未注册",color:"default"}},S=["SIP","PJSIP","IAX"],U=["张伟","李娜","王芳","刘洋","陈静","赵磊","孙敏","钱军","周婷","吴杰"],P=Array.from({length:20},(l,s)=>({id:s+1,number:String(8001+s),name:U[s%10],type:S[s%3],status:s%4===3?"unregistered":"registered",registeredIp:s%4===3?"":`192.168.${Math.floor(s/5)}.${100+s}`})),te=()=>{const[l,s]=r.useState(P),[E,p]=r.useState(P.length),[O,j]=r.useState(!1),[h,I]=r.useState(1),[b,F]=r.useState(""),[M,o]=r.useState(!1),[c,w]=r.useState(null),[z,C]=r.useState(!1),[d]=i.useForm(),T=r.useCallback(async()=>{j(!0);try{const e=await m.list({page:h,pageSize:10,keyword:b});s(e.records),p(e.total)}catch{}finally{j(!1)}},[h,b]);r.useEffect(()=>{T()},[T]);const $=()=>{w(null),d.resetFields(),o(!0)},_=e=>{w(e),d.setFieldsValue(e),o(!0)},A=async e=>{try{await m.remove(e)}catch{}s(a=>a.filter(n=>n.id!==e)),p(a=>a-1),g.success("删除成功")},L=async()=>{C(!0);try{const e=await d.validateFields();if(c){try{await m.update(c.id,e)}catch{}s(a=>a.map(n=>n.id===c.id?{...n,...e}:n)),g.success("更新成功")}else{const a={...e,id:Date.now(),registeredIp:""};try{const n=await m.create(e);s(R=>[n,...R])}catch{s(n=>[a,...n])}p(n=>n+1),g.success("创建成功")}o(!1)}finally{C(!1)}},N=[{title:"分机号",dataIndex:"number",key:"number",width:90},{title:"姓名",dataIndex:"name",key:"name",width:100},{title:"类型",dataIndex:"type",key:"type",width:80,render:e=>t.jsx(k,{color:Q[e],children:e}),filters:S.map(e=>({text:e,value:e})),onFilter:(e,a)=>a.type===e},{title:"状态",dataIndex:"status",key:"status",width:90,render:e=>t.jsx(k,{color:f[e].color,children:f[e].label}),filters:Object.entries(f).map(([e,a])=>({text:a.label,value:e})),onFilter:(e,a)=>a.status===e},{title:"注册 IP",dataIndex:"registeredIp",key:"registeredIp",render:e=>e?t.jsx("span",{style:{fontFamily:"monospace"},children:e}):t.jsx("span",{style:{color:"#bbb"},children:"—"})},{title:"操作",key:"action",width:130,align:"center",render:(e,a)=>t.jsxs(q,{size:0,children:[t.jsx(x,{type:"link",size:"small",icon:t.jsx(B,{}),onClick:()=>_(a),children:"编辑"}),t.jsx(D,{title:"确定删除该分机？",onConfirm:()=>A(a.id),children:t.jsx(x,{type:"link",size:"small",danger:!0,icon:t.jsx(K,{}),children:"删除"})})]})}];return t.jsxs("div",{children:[t.jsx(X.Title,{level:4,style:{marginBottom:16},children:"分机管理"}),t.jsxs(J,{children:[t.jsxs("div",{style:{marginBottom:16,display:"flex",gap:8},children:[t.jsx(y.Search,{placeholder:"搜索分机号/姓名...",style:{width:280},allowClear:!0,onSearch:e=>{I(1),F(e)}}),t.jsx(x,{type:"primary",icon:t.jsx(V,{}),onClick:$,children:"新建分机"})]}),t.jsx(Y,{dataSource:l,columns:N,rowKey:"id",loading:O,size:"middle",pagination:{current:h,pageSize:10,total:E,onChange:e=>I(e),showSizeChanger:!1,showTotal:e=>`共 ${e} 条`}})]}),t.jsx(G,{title:c?"编辑分机":"新建分机",open:M,onOk:L,onCancel:()=>o(!1),confirmLoading:z,destroyOnClose:!0,width:440,children:t.jsxs(i,{form:d,layout:"vertical",style:{marginTop:16},children:[t.jsx(i.Item,{name:"number",label:"分机号",rules:[{required:!0,message:"请输入分机号"}],children:t.jsx(y,{placeholder:"如：8001"})}),t.jsx(i.Item,{name:"name",label:"姓名",rules:[{required:!0,message:"请输入姓名"}],children:t.jsx(y,{placeholder:"分机所属人姓名"})}),t.jsx(i.Item,{name:"type",label:"类型",rules:[{required:!0}],initialValue:"PJSIP",children:t.jsx(v,{options:S.map(e=>({value:e,label:e}))})}),t.jsx(i.Item,{name:"status",label:"状态",rules:[{required:!0}],initialValue:"unregistered",children:t.jsx(v,{options:[{value:"registered",label:"已注册"},{value:"unregistered",label:"未注册"}]})})]})})]})};export{te as default};
