import{j as t}from"./index-B5tky5X5.js";import{r as a}from"./vendor-DqoTkSux.js";import{N as f,T as P,r as H,B as S,az as F,Y as N,Z as Q,K as R,_ as X,S as Z,a6 as y,O as w,a7 as G,a0 as k,a5 as J,M as V,R as b,U as r,a as $,h as M,i as W,Q as D,ak as q,$ as z,am as ee}from"./antd-BHLZumV9.js";import"./store-DlF-iav1.js";const{Title:te}=P,{RangePicker:se}=G,{Option:l}=y,{TextArea:ne}=w,re={pending:"orange",sent:"blue",delivered:"green",failed:"red"},ie={pending:"待发送",sent:"已发送",delivered:"已送达",failed:"发送失败"},ae={pending:t.jsx(ee,{spin:!0}),sent:t.jsx(z,{}),delivered:t.jsx(z,{}),failed:t.jsx(q,{})},B=[{id:1,direction:"outbound",from:"10086",to:"13800138001",body:"您的验证码是：523847，5分钟内有效。",status:"delivered",createdAt:r().subtract(10,"minute").toISOString(),sentAt:r().subtract(9,"minute").toISOString()},{id:2,direction:"inbound",from:"13912345678",to:"10086",body:"我想了解一下你们的套餐详情。",status:"delivered",createdAt:r().subtract(20,"minute").toISOString()},{id:3,direction:"outbound",from:"10086",to:"13700137002",body:"亲爱的用户，您的订单已确认，预计3个工作日内发货。",status:"sent",createdAt:r().subtract(1,"hour").toISOString(),sentAt:r().subtract(59,"minute").toISOString()},{id:4,direction:"outbound",from:"10086",to:"13600136003",body:"系统维护通知：今晚22:00-24:00服务暂停。",status:"failed",createdAt:r().subtract(2,"hour").toISOString(),errorMsg:"号码不存在"},{id:5,direction:"inbound",from:"15011223344",to:"10086",body:"退订",status:"delivered",createdAt:r().subtract(3,"hour").toISOString()},{id:6,direction:"outbound",from:"10086",to:"18888888888",body:"您好，这是一条测试短信，请忽略。",status:"pending",createdAt:r().subtract(5,"minute").toISOString()}],ue=()=>{const[i,I]=a.useState(B),[Y,v]=a.useState(B),[_,g]=a.useState(!1),[L,T]=a.useState(!1),[d,C]=a.useState(""),[c,O]=a.useState(""),[u,A]=a.useState(""),[h]=f.useForm(),j=a.useCallback((e,s,n,o)=>{v(e.filter(x=>!(s&&x.direction!==s||n&&x.status!==n||o&&!x.from.includes(o)&&!x.to.includes(o)&&!x.body.includes(o))))},[]),p=(e=c,s=u,n=d)=>{O(e),A(s),C(n),j(i,e,s,n)},U=async()=>{const e=await h.validateFields();T(!0),await new Promise(o=>setTimeout(o,800));const n=[{id:Date.now(),direction:"outbound",from:"10086",to:e.to,body:e.body,status:"pending",createdAt:new Date().toISOString()},...i];I(n),j(n,c,u,d),D.success("短信已加入发送队列"),h.resetFields(),g(!1),T(!1)},E=e=>{const s=i.map(n=>n.id===e?{...n,status:"pending"}:n);I(s),j(s,c,u,d),D.info("已重新加入发送队列")},m={total:i.length,delivered:i.filter(e=>e.status==="delivered").length,failed:i.filter(e=>e.status==="failed").length,inbound:i.filter(e=>e.direction==="inbound").length},K=[{title:"方向",dataIndex:"direction",width:80,render:e=>t.jsx($,{color:e==="inbound"?"cyan":"geekblue",children:e==="inbound"?"上行":"下行"})},{title:"发送方",dataIndex:"from",width:130,render:e=>t.jsxs(t.Fragment,{children:[t.jsx(b,{style:{marginRight:4}}),e]})},{title:"接收方",dataIndex:"to",width:130,render:e=>t.jsxs(t.Fragment,{children:[t.jsx(b,{style:{marginRight:4}}),e]})},{title:"短信内容",dataIndex:"body",ellipsis:!0,render:e=>t.jsx(M,{title:e,children:t.jsx("span",{style:{cursor:"default"},children:e.length>40?`${e.slice(0,40)}…`:e})})},{title:"状态",dataIndex:"status",width:110,render:(e,s)=>t.jsxs(M,{title:e==="failed"?s.errorMsg:void 0,children:[t.jsx(W,{status:e==="delivered"?"success":e==="failed"?"error":e==="sent"?"processing":"warning"}),t.jsxs($,{color:re[e],style:{marginLeft:4},children:[ae[e]," ",ie[e]]})]})},{title:"时间",dataIndex:"createdAt",width:150,render:e=>r(e).format("MM-DD HH:mm:ss"),sorter:(e,s)=>r(e.createdAt).unix()-r(s.createdAt).unix()},{title:"操作",width:100,align:"center",render:(e,s)=>s.status==="failed"?t.jsx(S,{size:"small",type:"link",icon:t.jsx(k,{}),onClick:()=>E(s.id),children:"重试"}):null}];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsxs(te,{level:4,style:{margin:0},children:[t.jsx(H,{})," 短信中心"]}),t.jsx(S,{type:"primary",icon:t.jsx(F,{}),onClick:()=>g(!0),children:"发送短信"})]}),t.jsx(N,{gutter:[12,12],style:{marginBottom:16},children:[{title:"短信总量",value:m.total,color:"#1677ff"},{title:"已送达",value:m.delivered,color:"#52c41a"},{title:"发送失败",value:m.failed,color:"#ff4d4f"},{title:"上行短信",value:m.inbound,color:"#fa8c16"}].map(e=>t.jsx(Q,{xs:12,sm:6,children:t.jsx(R,{size:"small",style:{borderTop:`3px solid ${e.color}`,borderRadius:8},children:t.jsx(X,{title:e.title,value:e.value,valueStyle:{color:e.color,fontSize:22}})})},e.title))}),t.jsx(R,{size:"small",style:{marginBottom:12},children:t.jsxs(Z,{wrap:!0,children:[t.jsxs(y,{placeholder:"方向",allowClear:!0,style:{width:100},onChange:e=>p(e||"",u,d),children:[t.jsx(l,{value:"inbound",children:"上行"}),t.jsx(l,{value:"outbound",children:"下行"})]}),t.jsxs(y,{placeholder:"状态",allowClear:!0,style:{width:120},onChange:e=>p(c,e||"",d),children:[t.jsx(l,{value:"pending",children:"待发送"}),t.jsx(l,{value:"sent",children:"已发送"}),t.jsx(l,{value:"delivered",children:"已送达"}),t.jsx(l,{value:"failed",children:"发送失败"})]}),t.jsx(w.Search,{placeholder:"搜索号码/内容",allowClear:!0,style:{width:220},onSearch:e=>p(c,u,e)}),t.jsx(se,{format:"YYYY-MM-DD"}),t.jsx(S,{icon:t.jsx(k,{}),onClick:()=>{v(i),O(""),A(""),C("")},children:"重置"})]})}),t.jsx(J,{columns:K,dataSource:Y,rowKey:"id",size:"small",pagination:{pageSize:20,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}}),t.jsx(V,{title:t.jsxs(t.Fragment,{children:[t.jsx(F,{})," 发送短信"]}),open:_,onCancel:()=>{g(!1),h.resetFields()},onOk:U,confirmLoading:L,okText:"发送",cancelText:"取消",children:t.jsxs(f,{form:h,layout:"vertical",style:{marginTop:16},children:[t.jsx(f.Item,{name:"to",label:"接收号码",rules:[{required:!0,message:"请输入接收号码"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}],children:t.jsx(w,{prefix:t.jsx(b,{}),placeholder:"请输入手机号码"})}),t.jsx(f.Item,{name:"body",label:"短信内容",rules:[{required:!0,message:"请输入短信内容"},{max:500,message:"最多500字符"}],children:t.jsx(ne,{rows:4,showCount:!0,maxLength:500,placeholder:"请输入短信内容..."})})]})})]})};export{ue as default};
